import path from "path";
import { promises as fs } from "fs";

const logo_b64 = "PD94bWwgdmVyc2lvbj0nMS4wJyBlbmNvZGluZz0nVVRGLTgnPz48c3ZnIGZpbGw9J25vbmUnIHZpZXdCb3g9JzAgMCA1MTIgNTEyJyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnPjxwYXRoIGQ9J00yNy44Mzg3IDBIMi4xNjEyN0MwLjk2NzYzNiAwIDAgMC45Njc2MzYgMCAyLjE2MTI3VjI3LjgzODdDMCAyOS4wMzI0IDAuOTY3NjM2IDMwIDIuMTYxMjcgMzBIMjcuODM4N0MyOS4wMzI0IDMwIDMwIDI5LjAzMjQgMzAgMjcuODM4N1YyLjE2MTI3QzMwIDAuOTY3NjM2IDI5LjAzMjQgMCAyNy44Mzg3IDBaJyBmaWxsPScjMjYyODNEJy8+PHBhdGggZD0nbTI3Ljc3OCAxLjAzMTRoLTI1LjU1NGMtMC42NTg0MiAwLTEuMTkyMiAwLjUzMzc1LTEuMTkyMiAxLjE5MjJ2MjUuNTU0YzAgMC42NTg0IDAuNTMzNzUgMS4xOTIyIDEuMTkyMiAxLjE5MjJoMjUuNTU0YzAuNjU4NCAwIDEuMTkyMi0wLjUzMzggMS4xOTIyLTEuMTkyMnYtMjUuNTU0YzAtMC42NTg0My0wLjUzMzgtMS4xOTIyLTEuMTkyMi0xLjE5MjJ6JyBmaWxsPSd1cmwoI2IpJy8+PHBhdGggZD0nbTE3LjQ2NiAyNy4zMzZjLTAuMzY2NSAwLTAuNzExMy0wLjAxNi0xLjA1MzEtMC4wNDY0LTAuNDAyOC0wLjAyNTItMC44MDI0LTAuMDg3Ny0xLjE5MzctMC4xODY5LTAuNzg5MS0wLjIyNjktMS41MjY5LTAuNjA0Mi0yLjE3MjgtMS4xMTEtMC45MDY1LTAuNjk0Ny0xLjY2MzMtMS41NjUzLTIuMjI1LTIuNTU5Ni0wLjIyNi0wLjM5ODQtMC40MzQ2LTAuOTU0Ny0wLjk4Nzk3LTIuNDQyMy0wLjEyMTY4LTAuMzI4OS0wLjIxMjk0LTAuNTc5NS0wLjI4OTcyLTAuNzgwOC0wLjE3OTYyLTAuNDg4Mi0wLjIzOTAxLTAuNjUzMy0wLjM4NTMyLTAuOTcwNi0wLjE5MDg0LTAuNDUzMi0wLjQyNTE1LTAuODg2OS0wLjY5OTY2LTEuMjk1LTAuMzM1NDYtMC40NjY3LTAuNzI0MzktMC44OTI2LTEuMTU4OS0xLjI2OS0wLjE2NjU4LTAuMTQ0OC0wLjI0MzM2LTAuMjEyOS0wLjM4NTMyLTAuMzIzLTAuMTc2NzMtMC4xNDQ4LTAuNDIwMDktMC4zMzMyLTAuODg2NTMtMC43NDE3LTAuNzg4MDItMC42OTI0LTEuMDg1LTEuMDE0LTEuMzU4OC0xLjM2NDUtMC40MTI3OS0wLjUwMzYtMC43NDE1LTEuMDcwNS0wLjk3MzQ0LTEuNjc4OS0wLjIwMjktMC41MzkyLTAuMzIxMTYtMS4xMDY1LTAuMzUwNTYtMS42ODE4LTAuMDE0OTgtMC41MDE3IDAuMDM4MTMtMS4wMDMyIDAuMTU3ODktMS40OTA2IDAuMTkyMDItMC45Mzg4OCAwLjUwOTctMS44NDc2IDAuOTQ0NDgtMi43MDE2IDAuMzAwOTctMC42MzUwNyAwLjY5MTItMS4yMjM4IDEuMTU4OS0xLjc0ODQgMC41NTQwMi0wLjU5NjYyIDEuMTk0Ny0xLjEwNjQgMS45MDA1LTEuNTEyMyAwLjMyMzY4LTAuMTkwNTMgMC42NjI4OS0wLjM1MzM1IDEuMDE0LTAuNDg2NzIgMC41MjE2OS0wLjE4Nzc0IDEuMDcyMy0wLjI4MjM3IDEuNjI2OC0wLjI3OTU4IDAuNDk2MyAwLjAwMTE1IDAuOTkwMyAwLjA2ODM4IDEuNDY4OCAwLjE5OTkxIDAuOTU5NSAwLjIzNTIxIDEuODE2OSAwLjc3NDk2IDIuNDQzOCAxLjUzODQgMC42NjA1IDAuODE3IDAuOTI3MSAxLjg0NCAxLjE0MjkgMy4yMzYxIDAuMDU1IDAuMzYyMTUgMC4wNzY4IDAuNTQ5MDEgMC4wOTU2IDAuNzEyNyAwLjAxMTYgMC4xMTI5OSAwLjAyNDYgMC4yMjU5OCAwLjA1MzYgMC40MjU4OCAwLjE3NTMgMS4xOTM2IDAuMjYyMiAxLjczODMgMC40NjIxIDIuMTU0IDAuMjg5NyAwLjYwODQgMC44NDMxIDAuOTYzMyAxLjIwNjcgMS4xOTggMC44OTIzIDAuNTc5NCAxLjgxMzYgMC42NTc2IDIuNDIzNCAwLjcxMTIgMC4yNDA1IDAuMDIxNyAwLjUxNDMgMC4wMzMzIDAuODEyNyAwLjAzMzMgMC40NDYxIDAgMC44MTctMC4wMjQ2IDAuOTU0Ni0wLjAzNDcgMC4yNzM4LTAuMDIwMyAwLjUwMjYtMC4wNDY0IDAuNzI0My0wLjA3MjUgMC4zMzYyLTAuMDQ1NCAwLjY3NDgtMC4wNzA1IDEuMDE0LTAuMDc1MyAwLjQyNDgtM2UtNCAwLjg0NzggMC4wNTY3IDEuMjU3MyAwLjE2OTUgMC44ODk1IDAuMjA1MSAxLjY5MTggMC42ODUxIDIuMjkzMSAxLjM3MTggMC42MDk5IDAuNzI0MyAwLjc3MzYgMS40Mzg0IDAuOTc5MyAyLjM0NjcgMC4xMzk4IDAuNjA2NiAwLjIyNzUgMS4yMjQgMC4yNjIyIDEuODQ1NSAwLjAzNDcgMC43MDU0IDAuMDgyNSAxLjY2ODctMC4yNDkyIDIuODA0NC0wLjMxOTggMS4wNDQ0LTAuODY5NyAyLjAwMzctMS42MDk0IDIuODA3NC0wLjc3NTggMC44NzAzLTEuNzA5NyAxLjU4NTYtMi43NTIyIDIuMTA3Ni0wLjU5MTYgMC4yOTAxLTEuMjEwMiAwLjUyMTYtMS44NDcgMC42OTEtMC44ODMzIDAuMjQ3Mi0xLjc5MDQgMC40MDAyLTIuNzA1OSAwLjQ1NjMtMC4zODY4IDAuMDI5LTAuNzYwNSAwLjA0MzUtMS4xMTI1IDAuMDQzNXonIGZpbGw9JyMyNjI4M0QnLz48cGF0aCBkPSdtMTcuNDY2IDI2LjIyNmMtMC4zMzMyIDAtMC42NDYxLTAuMDEzMS0wLjk1NDYtMC4wNDA2LTAuMzQyMS0wLjAyMDEtMC42ODE2LTAuMDcyLTEuMDE0LTAuMTU1LTAuNjUwMS0wLjE4OTctMS4yNTc1LTAuNTAzLTEuNzg5LTAuOTIyNy0wLjc4MzktMC42MDM2LTEuNDM4MS0xLjM1ODgtMS45MjM3LTIuMjIwNy0wLjE4MjYtMC4zMjMtMC4zOTY5LTAuODk2Ny0wLjkxNDEtMi4yODQ0LTAuMTIxNy0wLjMyNDUtMC4yMTE1LTAuNTcwOC0wLjI4OTctMC43NzM2LTAuMTc5Ni0wLjQ5MS0wLjI1MzUtMC42OTUzLTAuNDE4Ni0xLjA1MzEtMC4yMTgyMS0wLjUxMjUtMC40ODUtMS4wMDI5LTAuNzk2NzYtMS40NjQ1LTAuMzgyODYtMC41MzI3LTAuODI2NzMtMS4wMTg5LTEuMzIyNi0xLjQ0ODYtMC4xOTU1NS0wLjE3ODEtMC4yOTk4NS0wLjI2MDctMC40NDQ3MS0wLjM3NTEtMC4xNzgxNy0wLjE0NDktMC4zOTgzNi0wLjMxNDQtMC44NDMwNy0wLjcwNC0wLjcyNDI5LTAuNjM0NS0wLjk4NTAzLTAuOTE3LTEuMjE2OC0xLjIxMzktMC4zNDIyMi0wLjQxNTEtMC42MTUxNy0wLjg4MjgtMC44MDgzMS0xLjM4NDktMC4zMTgyNi0wLjgxMTgtMC4zNjkwMS0xLjcwNC0wLjE0NDg2LTIuNTQ2NiAwLjE3MDg0LTAuODQ1ODcgMC40NTU5Mi0xLjY2NDYgMC44NDc0Mi0yLjQzMzYgMC4yNTY4OC0wLjU0NzExIDAuNTkxMDUtMS4wNTQ1IDAuOTkyMjctMS41MDY1IDAuNDc0OTgtMC41MTQyIDEuMDI0OS0wLjk1MzcyIDEuNjMxMS0xLjMwMzcgMC4yNjk4MS0wLjE1ODczIDAuNTUyMjctMC4yOTQ4OCAwLjg0NDUyLTAuNDA3MDUgMC4zOTk0My0wLjE0Mzk5IDAuODIxMi0wLjIxNjA4IDEuMjQ1OC0wLjIxMjk0IDAuMzk5IDAuMDAyMjggMC43OTU5IDAuMDU2ODMgMS4xODA2IDAuMTYyMjQgMC43MzMzIDAuMTcxNDggMS4zOTAyIDAuNTc4NTQgMS44NzAxIDEuMTU4OSAwLjQzNDYgMC41NDYxMSAwLjY4ODEgMS4yODA1IDAuOTA5NyAyLjcwODggMC4wNTIyIDAuMzM4OTcgMC4wNzEgMC41MDU1NiAwLjA4ODQgMC42NjYzNSAwLjAxMyAwLjEyMzEzIDAuMDI3NSAwLjI0NjI2IDAuMDU5NCAwLjQ2MzU0IDAuMTc5NiAxLjIxODMgMC4yNzgxIDEuODkwNCAwLjU2MDYgMi40NzU2IDAuNDM0NiAwLjg4OCAxLjE1ODggMS4zNjMxIDEuNjAzNiAxLjY0NTYgMS4xMjEyIDAuNzI0MyAyLjI1MSAwLjgyNTcgMi45MjYxIDAuODg2NSAwLjI3MjMgMC4wMjQ3IDAuNTc5NCAwLjAzNjMgMC45MTExIDAuMDM2MyAwLjQ4MzkgMCAwLjg4NjYtMC4wMjYxIDEuMDM4Ny0wLjAzNzcgMC4yODk3LTAuMDIxNyAwLjU0NDYtMC4wNTA3IDAuNzY2My0wLjA3NjggMC4yOTI1LTAuMDM5NyAwLjU4Ny0wLjA2MjQgMC44ODIxLTAuMDY4MSAwLjMyNjYtNGUtNCAwLjY1MTcgMC4wNDM5IDAuOTY2MiAwLjEzMTkgMC4zNzA5IDAuMDk5OSAxLjE0MTUgMC4zMDk5IDEuNzM4MyAxLjAxNCAwLjQzNDYgMC41MTcxIDAuNTU5MiAxLjA1ODkgMC43NDYgMS44ODMxIDAuMTI1NiAwLjU0MzcgMC4yMDQ2IDEuMDk3MSAwLjIzNjIgMS42NTQzIDAuMDMxOCAwLjY2MDUgMC4wNzI0IDEuNDgxOS0wLjIwNzIgMi40Mzc5LTAuMjc1MSAwLjg5MTQtMC43NDc0IDEuNzA5My0xLjM4MTkgMi4zOTMxLTAuNjgxOSAwLjc2MTQtMS41MDIzIDEuMzg2My0yLjQxNzcgMS44NDExLTAuNTI5NiAwLjI2MDEtMS4wODM3IDAuNDY2OC0xLjY1NDMgMC42MTcxLTAuODEyNiAwLjIyNi0xLjY0NjcgMC4zNjU4LTIuNDg4NiAwLjQxNzItMC4zNDYyIDAuMDMzMy0wLjY4NjYgMC4wNDA2LTEuMDE0IDAuMDQwNnonIGZpbGw9JyNBNTk2NzgnLz48cGF0aCBkPSdtOS4yMTE1IDQuODM1NGMwLjgyMTMxLTAuMzAxMyAxLjYzOTgtMC4wOTEyNiAxLjg4MzEtMC4wMjc1MiAwLjU1MDcgMC4xMjY3MSAxLjA0MzggMC40MzIzNiAxLjQwMjMgMC44NjkxNCAwLjMyMyAwLjM5ODM2IDAuNTI0MyAxLjAxNCAwLjcyNDIgMi4yNzg2IDAuMDkxMyAwLjU4ODEyIDAuMDczOSAwLjYxNDIgMC4xNDQ5IDEuMTIyNiAwLjE4NjkgMS4yNjkgMC4yOTg0IDIuMDI4IDAuNjQxNyAyLjczNzggMC41NDAzIDEuMTE1NCAxLjQ0ODYgMS43MDUgMS45MjUyIDIuMDEwNyAxLjMwMzcgMC44NDU5IDIuNjA3NCAwLjk2MTggMy4zMzE3IDEuMDI3IDAuNjk3OCAwLjA1MTYgMS4zOTg0IDAuMDUxNiAyLjA5NjEgMCAxLjExMTEtMC4wODI2IDEuNTUxNC0wLjI0OTIgMi4zMTA1LTAuMDQyIDAuMzM0NiAwLjA4OTggMC44Nzc4IDAuMjQ2MiAxLjI4MzQgMC43MjQzIDAuMjg5NyAwLjM0OTEgMC4zODI0IDAuNzI0MyAwLjU1NjMgMS40OTY0IDAuMTE0MSAwLjQ5MjIgMC4xODU4IDAuOTkzMyAwLjIxNDQgMS40OTc4IDAuMDMxOCAwLjYzODggMC4wNjUxIDEuMzI5OC0wLjE3MSAyLjEzOTUtMC4yMzg2IDAuNzY2Ni0wLjY0ODMgMS40NjktMS4xOTggMi4wNTQxLTAuNjAzMiAwLjY3MzEtMS4zMjkzIDEuMjI0Ny0yLjEzOTUgMS42MjUzLTAuNDgwOCAwLjIzNDMtMC45ODQxIDAuNDE5Mi0xLjUwMjIgMC41NTE5LTAuNzU0NCAwLjIwOTYtMS41Mjg5IDAuMzM4Ny0yLjMxMDQgMC4zODUzLTAuNjA1IDAuMDUxLTEuMjEzMSAwLjA1MS0xLjgxOCAwLTAuMjg4Ny0wLjAxNjUtMC41NzUzLTAuMDU5Ni0wLjg1NjEtMC4xMjg5LTAuNTM3NS0wLjE1NzctMS4wMzg5LTAuNDE5LTEuNDc2MS0wLjc2OTItMC42ODg2LTAuNTI4My0xLjI2MzItMS4xOTA2LTEuNjg5MS0xLjk0NjktMC4xNDQ4LTAuMjYwNy0wLjM4MzgtMC44OTM3LTAuODU2MS0yLjE2MTItMC40MTcyLTEuMTE5OC0wLjQ3NjUtMS4zMzcxLTAuNzI0My0xLjg4MzItMC4yMzk0LTAuNTYyNC0wLjUzMzUtMS4wOTk5LTAuODc3OC0xLjYwNS0wLjQxODE2LTAuNTktMC45MDQzNy0xLjEyODctMS40NDg2LTEuNjA1LTAuNDY1LTAuNDIzLTAuNDkzOTctMC4zODI1LTEuMzAzNy0xLjA5MDgtMC43MDY5MS0wLjYyLTAuOTIyNzQtMC44NjE5LTEuMTAyNC0xLjA5MDgtMC4yODUwOC0wLjM0MjQtMC41MTI1OC0wLjcyODktMC42NzM1OS0xLjE0NDQtMC4xMjY0NC0wLjMzOTItMC4yMDAyMS0wLjY5NTgtMC4yMTg3My0xLjA1NzQtMC4wMDc3MS0wLjMzMDEgMC4wMzAzMS0wLjY1OTYgMC4xMTI5OS0wLjk3OTI1IDAuMTU0MDMtMC43Njk1IDAuNDEyODQtMS41MTQyIDAuNzY5MTktMi4yMTM0IDAuMjIxNTEtMC40NzMzIDAuNTA5ODItMC45MTIzNSAwLjg1NjExLTEuMzAzNyAwLjIyMzAzLTAuMjQwNDMgMC40NjUyNi0wLjQ2MjMxIDAuNzI0MjktMC42NjM0NCAwLjIxNzM2LTAuMTY4OTIgMC40NDYzMi0wLjMyMjM2IDAuNjg1MTctMC40NTkyIDAuMjI1MjctMC4xMzQ0NCAwLjQ2MDY1LTAuMjUxMTcgMC43MDQwMS0wLjM0OTExeicgZmlsbD0ndXJsKCNhKScvPjxkZWZzPjxyYWRpYWxncmFkaWVudCBpZD0nYicgY3g9JzAnIGN5PScwJyByPScxJyBncmFkaWVudHRyYW5zZm9ybT0ndHJhbnNsYXRlKDE1IDE1KSBzY2FsZSgyOC41MjEpJyBncmFkaWVudHVuaXRzPSd1c2VyU3BhY2VPblVzZSc+PHN0b3Agc3RvcC1jb2xvcj0nIzc0NkI3RicvPjxzdG9wIHN0b3AtY29sb3I9JyM2MTVCNkYnIG9mZnNldD0nLjEyJy8+PHN0b3Agc3RvcC1jb2xvcj0nIzUxNEM2MCcgb2Zmc2V0PScuMjYnLz48c3RvcCBzdG9wLWNvbG9yPScjNEI0NzVCJyBvZmZzZXQ9Jy4zNycvPjxzdG9wIHN0b3AtY29sb3I9JyM0RjRCNUYnIG9mZnNldD0nLjQ0Jy8+PHN0b3Agc3RvcC1jb2xvcj0nIzVBNTY2Qycgb2Zmc2V0PScuNTEnLz48c3RvcCBzdG9wLWNvbG9yPScjNkQ2ODgxJyBvZmZzZXQ9Jy41OScvPjxzdG9wIHN0b3AtY29sb3I9JyM4NzgyOUUnIG9mZnNldD0nLjY3Jy8+PHN0b3Agc3RvcC1jb2xvcj0nI0E5QTJDMycgb2Zmc2V0PScuNzQnLz48c3RvcCBzdG9wLWNvbG9yPScjQkNCNUQ5JyBvZmZzZXQ9Jy43OCcvPjwvcmFkaWFsZ3JhZGllbnQ+PGxpbmVhcmdyYWRpZW50IGlkPSdhJyB4MT0nNS41NDk0OScgeDI9JzIzLjk4ODQnIHkxPSc3Ljc5NjI0JyB5Mj0nMjMuNzM5MycgZ3JhZGllbnR1bml0cz0ndXNlclNwYWNlT25Vc2UnPjxzdG9wIHN0b3AtY29sb3I9JyM0NDg0OTEnIG9mZnNldD0nLjA1Jy8+PHN0b3Agc3RvcC1jb2xvcj0nIzRBNzk4Nicgb2Zmc2V0PScuMTUnLz48c3RvcCBzdG9wLWNvbG9yPScjNTA2RTdCJyBvZmZzZXQ9Jy4zMycvPjxzdG9wIHN0b3AtY29sb3I9JyM1MjZBNzcnIG9mZnNldD0nLjUyJy8+PHN0b3Agc3RvcC1jb2xvcj0nIzU2NzA3Qycgb2Zmc2V0PScuNicvPjxzdG9wIHN0b3AtY29sb3I9JyM2MDdGOEInIG9mZnNldD0nLjcnLz48c3RvcCBzdG9wLWNvbG9yPScjNzA5OUEzJyBvZmZzZXQ9Jy44MicvPjxzdG9wIHN0b3AtY29sb3I9JyM4N0JEQzQnIG9mZnNldD0nLjk0Jy8+PHN0b3Agc3RvcC1jb2xvcj0nIzk0RDFENicgb2Zmc2V0PScxJy8+PC9saW5lYXJncmFkaWVudD48L2RlZnM+PC9zdmc+Cg==";

export default async function handler(req, res) {
  const { slug } = req.query;
  const normalizedSlug = normalizeName(slug);
  const jsonDirectory = path.join(process.cwd(), 'public');
  const fileContents = await fs.readFile(jsonDirectory + '/index.json', 'utf8');
  const plugins = JSON.parse(fileContents)
  if (plugins[normalizedSlug]) {
    const shield_schema = {
        "color": "#0074B8",
        "label": "napari hub",
        "logoSvg": logo_b64,
        "message": slug,
        "schemaVersion": 1,
        "style": "flat-square"
    }
    return res.status(200).json(shield_schema);
  }
  else {
    return res.status(404).json('Plugin not found.')
  }
}

function normalizeName(name) {
  return name.replace(/[-_.]+/g, "-").toLowerCase();
}
